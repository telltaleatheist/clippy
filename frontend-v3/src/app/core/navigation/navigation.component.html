<!-- Top Header Navigation -->
<header class="header">
  <div class="header-container">
    <!-- Left Section: Logo and Library -->
    <div class="header-left">
      <!-- Back Button (shown when not on home) -->
      @if (!isHome()) {
        <button
          class="back-btn"
          (click)="goBack()"
          title="Back to Media Library"
        >
          <span class="btn-icon">â†</span>
        </button>
      }

      <!-- Logo -->
      <a routerLink="/" class="logo">
        <span class="logo-icon">ğŸ¬</span>
        <span class="logo-text gradient-text">ClipChimp</span>
      </a>

      <!-- Library Selector -->
      <button class="library-selector" (click)="openLibraryManager()">
        <span class="library-icon">ğŸ“</span>
        <span class="library-name">
          {{ libraryService.currentLibrary()?.name || 'No Library' }}
        </span>
        <span class="library-chevron">â–¼</span>
      </button>
    </div>

    <!-- Right Section: Controls -->
    <div class="header-right">
      <!-- Settings / Back to Library Toggle -->
      @if (isSettings()) {
        <a
          routerLink="/"
          class="header-btn nav-link"
          title="Back to Library"
        >
          <span class="btn-icon">ğŸ“¹</span>
          <span class="btn-text">Back to Library</span>
        </a>
      } @else {
        <a
          routerLink="/settings"
          class="header-btn nav-link"
          title="Settings"
        >
          <span class="btn-icon">âš™ï¸</span>
          <span class="btn-text">Settings</span>
        </a>
      }

      <!-- Notification Bell -->
      <app-notification-bell />

      <!-- Download Logs -->
      <button
        class="header-btn"
        (click)="downloadLogs()"
        aria-label="Download logs"
        title="Download console logs"
      >
        <span class="btn-icon">ğŸ“‹</span>
      </button>

      <!-- Theme Toggle -->
      <button
        class="header-btn"
        (click)="toggleTheme()"
        [attr.aria-label]="'Switch to ' + (themeService.isDarkMode() ? 'light' : 'dark') + ' mode'"
        title="Toggle theme"
      >
        <span class="btn-icon">
          {{ themeService.isDarkMode() ? 'â˜€ï¸' : 'ğŸŒ™' }}
        </span>
      </button>

      <!-- Mobile Menu Button -->
      <button
        class="mobile-menu-btn"
        (click)="toggleMobileMenu()"
        [attr.aria-label]="mobileMenuOpen() ? 'Close menu' : 'Open menu'"
        [attr.aria-expanded]="mobileMenuOpen()"
      >
        <span class="menu-icon" [class.open]="mobileMenuOpen()">
          <span></span>
          <span></span>
          <span></span>
        </span>
      </button>
    </div>
  </div>
</header>

<!-- Mobile Menu Dropdown -->
@if (mobileMenuOpen()) {
  <div class="mobile-menu">
    <button class="mobile-menu-item" (click)="openLibraryManager(); closeMobileMenu()">
      <span class="menu-item-icon">ğŸ“</span>
      <span>{{ libraryService.currentLibrary()?.name || 'Select Library' }}</span>
    </button>
    <a routerLink="/settings" class="mobile-menu-item" (click)="closeMobileMenu()">
      <span class="menu-item-icon">âš™ï¸</span>
      <span>Settings</span>
    </a>
    <button class="mobile-menu-item" (click)="downloadLogs(); closeMobileMenu()">
      <span class="menu-item-icon">ğŸ“‹</span>
      <span>Download Logs</span>
    </button>
    <button class="mobile-menu-item" (click)="toggleTheme(); closeMobileMenu()">
      <span class="menu-item-icon">{{ themeService.isDarkMode() ? 'â˜€ï¸' : 'ğŸŒ™' }}</span>
      <span>{{ themeService.isDarkMode() ? 'Light Mode' : 'Dark Mode' }}</span>
    </button>
  </div>
  <div class="mobile-backdrop" (click)="closeMobileMenu()"></div>
}

<!-- Library Manager Modal -->
<app-library-manager-modal
  [show]="libraryManagerOpen()"
  [existingLibraries]="libraryService.libraries()"
  (closed)="libraryManagerOpen.set(false)"
  (librarySelected)="onLibrarySelected($event)"
  (libraryCreated)="onLibraryCreated($event)"
  (libraryOpened)="onLibraryOpened($event)"
  (libraryUpdated)="onLibraryUpdated($event)"
  (librariesDeleted)="onLibrariesDeleted($event)"
/>
