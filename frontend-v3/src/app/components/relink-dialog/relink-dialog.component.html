<div class="relink-dialog">
  <h2 mat-dialog-title>
    <mat-icon>link</mat-icon>
    Relink Video
  </h2>

  <mat-dialog-content>
    <div class="analysis-info">
      <h3>{{ data.analysis.title }}</h3>
      <p class="original-path">
        <strong>Original path:</strong><br>
        {{ data.analysis.video.originalPath }}
      </p>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-container">
      <mat-spinner diameter="40"></mat-spinner>
      <p>Searching for video...</p>
    </div>

    <!-- Error Message -->
    <div *ngIf="!isLoading && errorMessage" class="error-message">
      <mat-icon>error</mat-icon>
      <p>{{ errorMessage }}</p>
    </div>

    <!-- High Confidence Suggestion -->
    <div *ngIf="!isLoading && confidence === 'high' && suggestedPath" class="suggestion-box high-confidence">
      <div class="suggestion-header">
        <mat-icon>check_circle</mat-icon>
        <h4>Video Found!</h4>
      </div>
      <p class="suggested-path">{{ suggestedPath }}</p>
      <button mat-raised-button color="primary" (click)="selectCandidate({ filename: '', fullPath: suggestedPath!, score: 1 })">
        Use This Video
      </button>
    </div>

    <!-- Candidates List -->
    <div *ngIf="!isLoading && candidates.length > 0 && confidence === 'low'" class="candidates-container">
      <h4>Possible Matches</h4>
      <p class="hint">Select the video that matches this analysis:</p>

      <mat-list class="candidates-list">
        <mat-list-item *ngFor="let candidate of candidates" (click)="selectCandidate(candidate)" class="candidate-item">
          <div class="candidate-content">
            <div class="candidate-header">
              <mat-icon>movie</mat-icon>
              <span class="filename">{{ candidate.filename }}</span>
            </div>
            <div class="candidate-path">{{ candidate.fullPath }}</div>
            <div class="candidate-score">
              <div class="score-bar">
                <div class="score-fill" [style.width.%]="candidate.score * 100" [style.background-color]="getConfidenceColor(candidate.score)"></div>
              </div>
              <span class="score-text" [style.color]="getConfidenceColor(candidate.score)">
                {{ getConfidenceText(candidate.score) }} ({{ (candidate.score * 100).toFixed(0) }}%)
              </span>
            </div>
          </div>
          <mat-icon class="select-icon">chevron_right</mat-icon>
        </mat-list-item>
      </mat-list>
    </div>

    <!-- No Results -->
    <div *ngIf="!isLoading && !errorMessage && candidates.length === 0 && !suggestedPath" class="no-results">
      <mat-icon>search_off</mat-icon>
      <p>No matching videos found in the clips collection</p>
      <p class="hint">Try manually selecting the video file</p>
    </div>
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-button (click)="cancel()">Cancel</button>
    <button mat-raised-button color="accent" (click)="manualSelect()" [disabled]="isLoading">
      <mat-icon>folder_open</mat-icon>
      Browse Files...
    </button>
  </mat-dialog-actions>
</div>
