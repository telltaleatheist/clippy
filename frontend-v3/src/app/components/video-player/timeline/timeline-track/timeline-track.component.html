<div class="timeline-track-container">
  <!-- Sections header with rounded top corners -->
  <div class="track-sections-header">
    <app-timeline-sections-layer
      [sections]="sections"
      [duration]="duration"
      [zoomState]="zoomState"
      [selectedSection]="selectedSection"
      (sectionClick)="onSectionClick($event)"
      (sectionHover)="onSectionHover($event)">
    </app-timeline-sections-layer>
  </div>

  <!-- Chapters layer - below sections, above waveform -->
  @if (chapters.length > 0) {
    <div class="track-chapters-header">
      <app-timeline-chapters-layer
        [chapters]="chapters"
        [duration]="duration"
        [zoomState]="zoomState"
        [currentTime]="currentTime"
        [selectedChapterId]="selectedChapterId"
        (chapterClick)="onChapterClick($event)"
        (chapterHover)="onChapterHover($event)">
      </app-timeline-chapters-layer>
    </div>
  }

  <!-- Waveform container with square corners -->
  <div class="track-waveform-container">
    <app-timeline-waveform
      [waveformData]="waveformData"
      [duration]="duration"
      [zoomState]="zoomState"
      [color]="waveformColor">
    </app-timeline-waveform>

    <!-- Selection overlay - positioned within waveform container -->
    @if (selection) {
      <div class="selection-overlay"
           [style.left.%]="getSelectionLeft()"
           [style.width.%]="getSelectionWidth()">
        <div class="selection-handle left"
             (mousedown)="onSelectionHandleMouseDown($event, 'left')">
        </div>
        <div class="selection-drag-area"
             (mousedown)="onSelectionDragMouseDown($event)">
        </div>
        <div class="selection-handle right"
             (mousedown)="onSelectionHandleMouseDown($event, 'right')">
        </div>
      </div>
    }
  </div>
</div>