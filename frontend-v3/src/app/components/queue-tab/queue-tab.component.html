<div class="queue-tab">
  <!-- Toolbar -->
  <div class="queue-toolbar">
    <div class="toolbar-section">
      <h2 class="section-title">Processing Queue</h2>
      <p class="section-subtitle">
        {{ pendingCount() }} pending Â· {{ processingCount() }} processing Â· {{ completedCount() }} completed
      </p>
    </div>
    <div class="toolbar-actions">
      <!-- Clear completed button (when completed items exist) -->
      @if (completedCount() > 0) {
        <button class="btn btn-secondary" (click)="onClearCompleted()">
          <span class="btn-icon">ğŸ§¹</span>
          <span>Clear Completed</span>
        </button>
      }

      <!-- Stop processing button (when processing items exist) -->
      @if (processingCount() > 0) {
        <button class="btn btn-danger" (click)="onStopProcessing()">
          <span class="btn-icon">â¹</span>
          <span>Stop Processing</span>
        </button>
      }

      <!-- Clear All button - shows when there are pending OR processing items -->
      @if (pendingCount() > 0 || processingCount() > 0) {
        <button class="btn btn-secondary" (click)="onClearAll()">
          <span class="btn-icon">ğŸ—‘ï¸</span>
          <span>Clear All</span>
        </button>
      }

      <!-- Show buttons when staging items exist -->
      @if (pendingCount() > 0) {
        <!-- Configure button (only when items selected) -->
        @if (selectedStagingIds().size > 0) {
          <button class="btn btn-secondary" (click)="onConfigureSelected()">
            <span class="btn-icon">âš™ï¸</span>
            <span>Configure</span>
            <span class="badge">{{ selectedStagingIds().size }}</span>
          </button>
        }

        <!-- Remove button (only when items selected) -->
        @if (selectedStagingIds().size > 0) {
          <button class="btn btn-secondary" (click)="onRemoveSelected()">
            <span class="btn-icon">ğŸ—‘ï¸</span>
            <span>Remove Selected</span>
            <span class="badge">{{ selectedStagingIds().size }}</span>
          </button>
        }

        <!-- Process Selected button (only when items selected) -->
        @if (selectedStagingIds().size > 0) {
          <button class="btn btn-primary" (click)="onProcessSelected()">
            <span class="btn-icon">â–¶</span>
            <span>Process Selected</span>
            <span class="badge">{{ selectedStagingIds().size }}</span>
          </button>
        }

        <!-- Process All button (always show when staging items exist) -->
        <button class="btn btn-primary" (click)="onProcessAll()">
          <span class="btn-icon">â–¶â–¶</span>
          <span>Process All</span>
          <span class="badge">{{ pendingCount() }}</span>
        </button>
      }
    </div>
  </div>

  <!-- Queue Content -->
  <div class="queue-content">
    <!-- Single Cascade showing Staging, Processing, and Completed -->
    <app-cascade
      *ngIf="allQueueWeeks().length > 0"
      [weeks]="allQueueWeeks()"
      [progressMapper]="progressMapper"
      [childrenConfig]="childrenConfig"
      [aiProcessingVideoId]="aiProcessingVideoId"
      [showStatusIndicator]="true"
      [showDeleteButton]="true"
      [deleteMode]="'simple'"
      (selectionChanged)="onStagingSelectionChanged($event)"
      (videoAction)="onVideoAction($event)"
      (configureItem)="configureItem.emit($event)"
      (previewRequested)="previewRequested.emit($event)"
    />

    <!-- Empty State -->
    <div class="empty-state" *ngIf="allQueueWeeks().length === 0">
      <div class="empty-icon">ğŸ“‹</div>
      <h3>No items in queue</h3>
      <p>Add videos using the Download button or select library videos and click "Add to Queue"</p>
    </div>
  </div>
</div>
