<!-- Video Info Page -->
<div class="video-info-container" *ngIf="videoInfo">
  <!-- Header Section -->
  <div class="video-header">
    <button class="back-btn" (click)="goBack()">
      <span>‚Üê</span> Back to Library
    </button>
    <div class="video-player-container">
      <video
        #videoPlayer
        class="video-player"
        controls
        [src]="getVideoStreamUrl()"
        preload="metadata">
        Your browser does not support the video tag.
      </video>
    </div>

    <div class="video-title-section">
      <h1 class="video-title">{{ videoInfo.title }}</h1>
      <div class="video-meta">
        <span class="meta-item">
          <span class="meta-icon">üìÖ</span>
          {{ formatDate(videoInfo.createdAt) }}
        </span>
        <span class="meta-item">
          <span class="meta-icon">üìÅ</span>
          {{ formatFileSize(videoInfo.metadata.fileSize) }}
        </span>
        <span class="meta-item">
          <span class="meta-icon">üé¨</span>
          {{ videoInfo.metadata.resolution }} &#64; {{ videoInfo.metadata.frameRate }}fps
        </span>
        <span class="meta-item status-badge" [class]="'status-' + videoInfo.processingStatus.overall">
          {{ videoInfo.processingStatus.overall | titlecase }}
        </span>
      </div>
    </div>
  </div>

  <!-- Tab Navigation -->
  <div class="tab-navigation">
    <button
      class="tab-button"
      [class.active]="activeTab === 'overview'"
      (click)="activeTab = 'overview'">
      <span class="tab-icon">üìä</span>
      Overview
    </button>
    <button
      class="tab-button"
      [class.active]="activeTab === 'metadata'"
      (click)="activeTab = 'metadata'">
      <span class="tab-icon">‚ÑπÔ∏è</span>
      Metadata
    </button>
    <button
      class="tab-button"
      [class.active]="activeTab === 'ai-analysis'"
      (click)="activeTab = 'ai-analysis'">
      <span class="tab-icon">ü§ñ</span>
      AI Analysis
      <span class="tab-badge">{{ videoInfo.aiAnalyses.length }}</span>
    </button>
    <button
      class="tab-button"
      [class.active]="activeTab === 'transcription'"
      (click)="activeTab = 'transcription'">
      <span class="tab-icon">üí¨</span>
      Transcription
    </button>
  </div>

  <!-- Tab Content -->
  <div class="tab-content">
    <!-- Overview Tab -->
    <div class="overview-tab" *ngIf="activeTab === 'overview'">
      <!-- Tags Section -->
      <div class="section-card">
        <div class="section-header" (click)="toggleSection('tags')">
          <h2 class="section-title">
            <span class="section-icon">üè∑Ô∏è</span>
            Tags
          </h2>
          <button class="section-toggle">
            <span [class.rotated]="!expandedSections.tags">‚ñ∂</span>
          </button>
        </div>
        <div class="section-content" *ngIf="expandedSections.tags">
          <div class="tags-container">
            <div class="tags-list">
              <span
                *ngFor="let tag of videoInfo.tags"
                class="tag"
                [style.background-color]="tag.color + '20'"
                [style.border-color]="tag.color">
                <span class="tag-name">{{ tag.name }}</span>
                <span class="tag-category" *ngIf="tag.category && tag.category !== 'custom'">{{ tag.category }}</span>
                <button class="tag-remove" (click)="removeTag(tag.id)">√ó</button>
              </span>

              <button
                *ngIf="!isAddingTag"
                class="add-tag-button"
                (click)="isAddingTag = true">
                <span class="button-icon">+</span>
                Add Tag
              </button>
            </div>

            <div class="add-tag-form" *ngIf="isAddingTag">
              <input
                type="text"
                class="tag-input"
                [(ngModel)]="newTagName"
                placeholder="Enter tag name"
                (keyup.enter)="addTag()">
              <select class="tag-category-select" [(ngModel)]="newTagCategory">
                <option value="genre">Genre</option>
                <option value="topic">Topic</option>
                <option value="mood">Mood</option>
                <option value="technical">Technical</option>
                <option value="custom">Custom</option>
              </select>
              <button class="save-button" (click)="addTag()">Save</button>
              <button class="cancel-button" (click)="isAddingTag = false">Cancel</button>

              <div class="suggested-tags">
                <span class="suggested-label">Suggested:</span>
                <button
                  *ngFor="let tag of suggestedTags"
                  class="suggested-tag"
                  (click)="addSuggestedTag(tag)">
                  {{ tag }}
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Description Section -->
      <div class="section-card">
        <div class="section-header" (click)="toggleSection('description')">
          <h2 class="section-title">
            <span class="section-icon">üìù</span>
            Description
          </h2>
          <div class="section-actions">
            <button
              *ngIf="!isEditingDescription && expandedSections.description"
              class="edit-button"
              (click)="editDescription(); $event.stopPropagation()">
              <span class="button-icon">‚úèÔ∏è</span>
              Edit
            </button>
            <button class="section-toggle">
              <span [class.rotated]="!expandedSections.description">‚ñ∂</span>
            </button>
          </div>
        </div>
        <div class="section-content" *ngIf="expandedSections.description">
          <div class="description-container">
            <p class="description-text" *ngIf="!isEditingDescription">
              {{ videoInfo.description }}
            </p>
            <div class="description-edit" *ngIf="isEditingDescription">
              <textarea
                class="description-textarea"
                [(ngModel)]="editedDescription"
                rows="6"
                placeholder="Enter video description...">
              </textarea>
              <div class="edit-actions">
                <button class="save-button" (click)="saveDescription()">Save</button>
                <button class="cancel-button" (click)="cancelDescriptionEdit()">Cancel</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Relationships Section -->
      <div class="section-card">
        <div class="section-header" (click)="toggleSection('children')">
          <h2 class="section-title">
            Relationships
            <span class="count-badge" *ngIf="getTotalRelationshipsCount() > 0">{{ getTotalRelationshipsCount() }}</span>
          </h2>
          <div class="section-actions">
            <button
              *ngIf="getTotalRelationshipsCount() > 0 && expandedSections.children && !showVideoSelector"
              class="remove-all-button"
              (click)="removeAllRelationships(); $event.stopPropagation()">
              Remove All
            </button>
            <button class="section-toggle">
              <span [class.rotated]="!expandedSections.children">‚ñ∂</span>
            </button>
          </div>
        </div>
        <div class="section-content" *ngIf="expandedSections.children">
          <div class="children-container">
            <!-- Placeholder State (No relationships and not selecting) -->
            <div class="no-children-state" *ngIf="getTotalRelationshipsCount() === 0 && !showVideoSelector">
              <div class="no-children-icon">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                  <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                  <circle cx="9" cy="7" r="4"/>
                  <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                  <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                </svg>
              </div>
              <h4 class="no-children-title">No Relationships</h4>
              <p class="no-children-description">
                Link related videos as parents or children to create a hierarchical organization.
              </p>
              <button class="add-children-btn" (click)="openVideoSelector(); $event.stopPropagation()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="12" y1="5" x2="12" y2="19"/>
                  <line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
                Add Children
              </button>
            </div>

            <!-- Relationships List (when has relationships and not selecting) -->
            <div class="children-list" *ngIf="getTotalRelationshipsCount() > 0 && !showVideoSelector">
              <!-- Parent Videos -->
              <div *ngIf="parentVideos.length > 0" class="relationship-group">
                <h3 class="relationship-group-title">Parents ({{ parentVideos.length }})</h3>
                <div
                  *ngFor="let parent of parentVideos"
                  class="child-item parent-item"
                  (click)="navigateToVideo(parent.id)">
                  <div class="relationship-icon">‚Üë</div>
                  <div class="child-thumbnail">
                    <img
                      [src]="'http://localhost:3000/api/database/videos/' + parent.id + '/thumbnail'"
                      [alt]="parent.filename"
                      onerror="this.src='assets/default-thumbnail.png'">
                  </div>
                  <div class="child-info">
                    <div class="child-name">{{ parent.filename }}</div>
                    <div class="child-meta">
                      <span *ngIf="parent.duration_seconds">
                        {{ formatDuration(parent.duration_seconds) }}
                      </span>
                      <span *ngIf="parent.file_size_bytes">
                        ‚Ä¢ {{ formatFileSize(parent.file_size_bytes) }}
                      </span>
                    </div>
                  </div>
                  <button
                    class="child-remove-btn"
                    (click)="removeParent(parent.id); $event.stopPropagation()"
                    title="Remove this parent">
                    √ó
                  </button>
                </div>
              </div>

              <!-- Child Videos -->
              <div *ngIf="childVideos.length > 0" class="relationship-group">
                <h3 class="relationship-group-title">Children ({{ childVideos.length }})</h3>
                <div
                  *ngFor="let child of childVideos"
                  class="child-item child-item-actual"
                  (click)="navigateToVideo(child.id)">
                  <div class="relationship-icon">‚Üì</div>
                  <div class="child-thumbnail">
                    <img
                      [src]="'http://localhost:3000/api/database/videos/' + child.id + '/thumbnail'"
                      [alt]="child.filename"
                      onerror="this.src='assets/default-thumbnail.png'">
                  </div>
                  <div class="child-info">
                    <div class="child-name">{{ child.filename }}</div>
                    <div class="child-meta">
                      <span *ngIf="child.duration_seconds">
                        {{ formatDuration(child.duration_seconds) }}
                      </span>
                      <span *ngIf="child.file_size_bytes">
                        ‚Ä¢ {{ formatFileSize(child.file_size_bytes) }}
                      </span>
                    </div>
                  </div>
                  <button
                    class="child-remove-btn"
                    (click)="removeChild(child.id); $event.stopPropagation()"
                    title="Remove this child">
                    √ó
                  </button>
                </div>
              </div>

              <button class="add-more-children-btn" (click)="openVideoSelector(); $event.stopPropagation()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="12" y1="5" x2="12" y2="19"/>
                  <line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
                Add More Children
              </button>
            </div>

            <!-- Video Selector (embedded in section) -->
            <div class="video-selector-embedded" *ngIf="showVideoSelector">
              <div class="selector-header">
                <input
                  type="text"
                  class="search-input"
                  [(ngModel)]="videoSearchQuery"
                  placeholder="Search videos..."
                  autofocus>
                <button class="cancel-selection-btn" (click)="cancelVideoSelection()">Cancel</button>
              </div>

              <!-- Cascade Component for Video Selection -->
              @if (availableVideosWeek.length > 0) {
                <div class="selector-cascade-wrapper">
                  <app-cascade
                    #videoSelectorCascade
                    [weeks]="filteredAvailableVideosWeek"
                    (selectionChanged)="onVideoSelectorSelectionChanged($event)">
                  </app-cascade>
                </div>
              } @else {
                <div class="selector-list-empty">
                  <p class="empty-state">Loading videos...</p>
                </div>
              }

              <div class="selector-footer">
                <button
                  class="submit-selection-btn"
                  [disabled]="selectedVideosForLink.size === 0"
                  (click)="addSelectedChildren()">
                  Add {{ selectedVideosForLink.size }} Video{{ selectedVideosForLink.size !== 1 ? 's' : '' }}
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Quick Insights -->
      <div class="section-card">
        <h2 class="section-title">
          <span class="section-icon">üí°</span>
          Quick Insights
        </h2>
        <div class="insights-grid">
          <div class="insight-card">
            <span class="insight-icon">‚è±Ô∏è</span>
            <span class="insight-value">{{ formatDuration(videoInfo.metadata.duration) }}</span>
            <span class="insight-label">Duration</span>
          </div>
          <div class="insight-card">
            <span class="insight-icon">üí¨</span>
            <span class="insight-value">{{ videoInfo.transcription.length }}</span>
            <span class="insight-label">Transcript Segments</span>
          </div>
          <div class="insight-card">
            <span class="insight-icon">ü§ñ</span>
            <span class="insight-value">{{ videoInfo.aiAnalyses.length }}</span>
            <span class="insight-label">AI Analyses</span>
          </div>
          <div class="insight-card">
            <span class="insight-icon">üè∑Ô∏è</span>
            <span class="insight-value">{{ videoInfo.tags.length }}</span>
            <span class="insight-label">Tags</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Metadata Tab -->
    <div class="metadata-tab" *ngIf="activeTab === 'metadata'">
      <div class="section-card">
        <h2 class="section-title">
          <span class="section-icon">üé•</span>
          Video Properties
        </h2>
        <div class="metadata-grid">
          <div class="metadata-group">
            <h3 class="group-title">Video</h3>
            <div class="metadata-item">
              <span class="metadata-label">Resolution:</span>
              <span class="metadata-value">{{ videoInfo.metadata.resolution }}</span>
            </div>
            <div class="metadata-item">
              <span class="metadata-label">Frame Rate:</span>
              <span class="metadata-value">{{ videoInfo.metadata.frameRate }} fps</span>
            </div>
            <div class="metadata-item">
              <span class="metadata-label">Bitrate:</span>
              <span class="metadata-value">{{ videoInfo.metadata.bitrate }} kbps</span>
            </div>
            <div class="metadata-item">
              <span class="metadata-label">Codec:</span>
              <span class="metadata-value">{{ videoInfo.metadata.codec }}</span>
            </div>
            <div class="metadata-item">
              <span class="metadata-label">Format:</span>
              <span class="metadata-value">{{ videoInfo.metadata.format }}</span>
            </div>
            <div class="metadata-item">
              <span class="metadata-label">Aspect Ratio:</span>
              <span class="metadata-value">{{ videoInfo.metadata.aspectRatio }}</span>
            </div>
          </div>

          <div class="metadata-group">
            <h3 class="group-title">Audio</h3>
            <div class="metadata-item">
              <span class="metadata-label">Channels:</span>
              <span class="metadata-value">{{ videoInfo.metadata.audioChannels }}</span>
            </div>
            <div class="metadata-item">
              <span class="metadata-label">Bitrate:</span>
              <span class="metadata-value">{{ videoInfo.metadata.audioBitrate }} kbps</span>
            </div>
            <div class="metadata-item">
              <span class="metadata-label">Codec:</span>
              <span class="metadata-value">{{ videoInfo.metadata.audioCodec }}</span>
            </div>
            <div class="metadata-item">
              <span class="metadata-label">Sample Rate:</span>
              <span class="metadata-value">{{ videoInfo.metadata.audioSampleRate }} Hz</span>
            </div>
          </div>

          <div class="metadata-group">
            <h3 class="group-title">File Info</h3>
            <div class="metadata-item">
              <span class="metadata-label">Size:</span>
              <span class="metadata-value">{{ formatFileSize(videoInfo.metadata.fileSize) }}</span>
            </div>
            <div class="metadata-item">
              <span class="metadata-label">Duration:</span>
              <span class="metadata-value">{{ formatDuration(videoInfo.metadata.duration) }}</span>
            </div>
            <div class="metadata-item" *ngIf="videoInfo.metadata.capturedDate">
              <span class="metadata-label">Captured:</span>
              <span class="metadata-value">{{ formatDate(videoInfo.metadata.capturedDate) }}</span>
            </div>
            <div class="metadata-item" *ngIf="videoInfo.metadata.device">
              <span class="metadata-label">Device:</span>
              <span class="metadata-value">{{ videoInfo.metadata.device }}</span>
            </div>
            <div class="metadata-item" *ngIf="videoInfo.metadata.software">
              <span class="metadata-label">Software:</span>
              <span class="metadata-value">{{ videoInfo.metadata.software }}</span>
            </div>
          </div>

          <div class="metadata-group">
            <div class="group-header">
              <h3 class="group-title">Dates</h3>
              <button
                *ngIf="!isEditingDates"
                class="edit-button-small"
                (click)="editDates()">
                ‚úèÔ∏è
              </button>
            </div>
            <ng-container *ngIf="!isEditingDates">
              <div class="metadata-item">
                <span class="metadata-label">Upload Date:</span>
                <span class="metadata-value">{{ videoInfo.uploadDate ? formatDate(videoInfo.uploadDate) : 'Not set' }}</span>
              </div>
              <div class="metadata-item">
                <span class="metadata-label">Download Date:</span>
                <span class="metadata-value">{{ formatDate(videoInfo.downloadDate) }}</span>
              </div>
            </ng-container>
            <ng-container *ngIf="isEditingDates">
              <div class="metadata-item edit-mode">
                <span class="metadata-label">Upload Date:</span>
                <input
                  type="date"
                  class="date-input"
                  [(ngModel)]="editedUploadDate"
                  placeholder="When content was filmed">
              </div>
              <div class="metadata-item edit-mode">
                <span class="metadata-label">Download Date:</span>
                <input
                  type="date"
                  class="date-input"
                  [(ngModel)]="editedDownloadDate">
              </div>
              <div class="edit-actions">
                <button class="save-button" (click)="saveDates()">Save</button>
                <button class="cancel-button" (click)="cancelDatesEdit()">Cancel</button>
              </div>
            </ng-container>
          </div>

          <div class="metadata-group" *ngIf="videoInfo.metadata.location">
            <h3 class="group-title">Location</h3>
            <div class="metadata-item">
              <span class="metadata-label">Name:</span>
              <span class="metadata-value">{{ videoInfo.metadata.location.name || 'Unknown' }}</span>
            </div>
            <div class="metadata-item">
              <span class="metadata-label">Coordinates:</span>
              <span class="metadata-value">
                {{ videoInfo.metadata.location.latitude }}, {{ videoInfo.metadata.location.longitude }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- AI Analysis Tab -->
    <div class="ai-analysis-tab" *ngIf="activeTab === 'ai-analysis'">
      <div class="analysis-header">
        <div class="analysis-filters">
          <button
            class="filter-button"
            [class.active]="analysisFilter === 'all'"
            (click)="analysisFilter = 'all'">
            All
          </button>
          <button
            class="filter-button"
            [class.active]="analysisFilter === 'summary'"
            (click)="analysisFilter = 'summary'">
            Summary
          </button>
          <button
            class="filter-button"
            [class.active]="analysisFilter === 'highlights'"
            (click)="analysisFilter = 'highlights'">
            Highlights
          </button>
          <button
            class="filter-button"
            [class.active]="analysisFilter === 'sentiment'"
            (click)="analysisFilter = 'sentiment'">
            Sentiment
          </button>
          <button
            class="filter-button"
            [class.active]="analysisFilter === 'topics'"
            (click)="analysisFilter = 'topics'">
            Topics
          </button>
        </div>
      </div>

      <!-- Section Cards - Each section is its own card -->
      <div class="section-cards-list">
        <ng-container *ngFor="let analysis of getFilteredAnalyses()">
          <!-- For highlights type, render each highlight as its own card -->
          <ng-container *ngIf="analysis.type === 'highlights'">
            <div
              *ngFor="let highlight of analysis.highlights; let i = index"
              class="section-card"
              [attr.data-category]="highlight.category">
              <div class="section-card-header">
                <span class="section-timestamp">{{ formatTime(highlight.timestamp) }}</span>
                <span class="section-category-badge">{{ highlight.category }}</span>
                <button
                  class="section-delete-btn"
                  (click)="deleteSection(i, $event)"
                  title="Delete this section">
                  √ó
                </button>
              </div>
              <p class="section-text">{{ highlight.text }}</p>
            </div>
          </ng-container>

          <!-- For other analysis types, keep the card format -->
          <div
            *ngIf="analysis.type !== 'highlights'"
            class="analysis-card"
            [class.expanded]="selectedAnalysis?.id === analysis.id"
            (click)="selectAnalysis(analysis)">
            <div class="analysis-card-header">
              <div class="analysis-info">
                <h3 class="analysis-title">
                  <span class="analysis-icon" [ngSwitch]="analysis.type">
                    <span *ngSwitchCase="'summary'">üìÑ</span>
                    <span *ngSwitchCase="'sentiment'">üòä</span>
                    <span *ngSwitchCase="'topics'">üè∑Ô∏è</span>
                    <span *ngSwitchCase="'entities'">üë§</span>
                    <span *ngSwitchCase="'scenes'">üé¨</span>
                    <span *ngSwitchDefault>üîç</span>
                  </span>
                  {{ analysis.title }}
                </h3>
                <div class="analysis-meta">
                  <span class="meta-badge model">{{ analysis.model }}</span>
                  <span class="meta-badge confidence" *ngIf="analysis.confidence">
                    {{ (analysis.confidence * 100) | number:'1.0-0' }}% confidence
                  </span>
                  <span class="meta-badge time">{{ formatDate(analysis.timestamp) }}</span>
                </div>
              </div>
              <button class="expand-button">
                <span [class.rotated]="selectedAnalysis?.id === analysis.id">‚ñ∂</span>
              </button>
            </div>

            <div class="analysis-card-content" *ngIf="selectedAnalysis?.id === analysis.id">
              <!-- Summary Type -->
              <div *ngIf="analysis.type === 'summary'" class="content-summary">
                <p>{{ analysis.content }}</p>
                <div class="analysis-tags" *ngIf="analysis.tags">
                  <span *ngFor="let tag of analysis.tags" class="analysis-tag">{{ tag }}</span>
                </div>
              </div>
            </div>
          </div>
        </ng-container>
      </div>
    </div>

    <!-- Transcription Tab -->
    <div class="transcription-tab" *ngIf="activeTab === 'transcription'">
      <div class="transcription-header">
        <div class="search-container">
          <div class="search-box">
            <input
              type="text"
              class="search-input"
              [(ngModel)]="transcriptionSearchQuery"
              (keyup.enter)="searchTranscription()"
              placeholder="Search transcription...">
            <button class="search-button" (click)="searchTranscription()">
              <span class="button-icon">üîç</span>
            </button>
            <button
              class="clear-button"
              *ngIf="transcriptionSearchQuery"
              (click)="clearSearch()">
              <span class="button-icon">‚úï</span>
            </button>
          </div>
          <div class="search-results" *ngIf="transcriptionSearchResults.length > 0">
            <span class="results-count">{{ transcriptionSearchResults.length }} results found</span>
          </div>
        </div>

        <div class="transcription-controls">
          <div class="view-toggle">
            <button
              class="toggle-button"
              [class.active]="transcriptionView === 'continuous'"
              (click)="transcriptionView = 'continuous'">
              Continuous
            </button>
            <button
              class="toggle-button"
              [class.active]="transcriptionView === 'segments'"
              (click)="transcriptionView = 'segments'">
              Segments
            </button>
          </div>

          <label class="timestamp-toggle">
            <input
              type="checkbox"
              [(ngModel)]="showTimestamps">
            <span>Show Timestamps</span>
          </label>

          <div class="export-menu">
            <button class="export-button">
              <span class="button-icon">üì•</span>
              Export
            </button>
            <div class="export-dropdown">
              <button (click)="exportTranscription('txt')">Text (.txt)</button>
              <button (click)="exportTranscription('srt')">Subtitles (.srt)</button>
              <button (click)="exportTranscription('vtt')">WebVTT (.vtt)</button>
              <button (click)="exportTranscription('json')">JSON (.json)</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Search Results -->
      <div class="search-results-list" *ngIf="transcriptionSearchResults.length > 0">
        <h3>Search Results</h3>
        <div
          *ngFor="let result of transcriptionSearchResults"
          class="search-result-item"
          (click)="jumpToSegment(result.segment)">
          <div class="result-time">{{ formatTime(result.segment.startTime) }}</div>
          <div class="result-text">
            <span class="context-before">{{ result.context.before }}</span>
            <span class="matched-text">{{ result.matchedText }}</span>
            <span class="context-after">{{ result.context.after }}</span>
          </div>
          <div class="result-speaker" *ngIf="result.segment.speaker">
            {{ result.segment.speaker }}
          </div>
        </div>
      </div>

      <!-- Transcription Content -->
      <div class="transcription-content">
        <!-- Continuous View -->
        <div class="continuous-view" *ngIf="transcriptionView === 'continuous'">
          <p class="continuous-text">
            <span
              *ngFor="let segment of videoInfo.transcription"
              [id]="'segment-' + segment.id"
              [class.highlighted]="highlightedSegmentId === segment.id"
              [class.clickable]="showTimestamps"
              (click)="showTimestamps && jumpToSegment(segment)"
              [title]="showTimestamps ? formatTime(segment.startTime) : ''">
              {{ segment.text }}
            </span>
          </p>
        </div>

        <!-- Segments View -->
        <div class="segments-view" *ngIf="transcriptionView === 'segments'">
          <div
            *ngFor="let segment of videoInfo.transcription"
            [id]="'segment-' + segment.id"
            class="segment-item"
            [class.highlighted]="highlightedSegmentId === segment.id"
            (click)="jumpToSegment(segment)">

            <div class="segment-header">
              <span class="segment-time" *ngIf="showTimestamps">
                {{ formatTime(segment.startTime) }} - {{ formatTime(segment.endTime) }}
              </span>
              <span class="segment-speaker" *ngIf="segment.speaker">
                {{ segment.speaker }}
              </span>
              <span class="segment-confidence" *ngIf="segment.confidence">
                {{ (segment.confidence * 100) | number:'1.0-0' }}%
              </span>
            </div>

            <div class="segment-text">
              {{ segment.text }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Loading State -->
<div class="loading-state" *ngIf="loading">
  <div class="loading-spinner"></div>
  <p>Loading video information...</p>
</div>

<!-- Error State -->
<div class="error-state" *ngIf="error && !loading">
  <span class="error-icon">‚ö†Ô∏è</span>
  <p>{{ error }}</p>
  <button class="back-button" (click)="goBack()">Back to Library</button>
</div>