<div class="video-editor">
  <!-- Header with controls -->
  <div class="editor-header">
    <div class="header-left">
      <h2 class="editor-title">
        <span class="title-icon">üé¨</span>
        Video Editor
      </h2>
      <span class="project-name">{{ metadata().filename }}</span>
    </div>

    <div class="header-center">
      <button class="control-btn" (click)="skipBackward()" title="Skip back 5s">
        <span>‚èÆ</span>
      </button>
      <button class="control-btn play-btn" (click)="togglePlayPause()" title="Play/Pause">
        <span>{{ editorState().isPlaying ? '‚è∏' : '‚ñ∂' }}</span>
      </button>
      <button class="control-btn" (click)="skipForward()" title="Skip forward 5s">
        <span>‚è≠</span>
      </button>

      <div class="time-display">
        <span class="current-time">{{ formattedCurrentTime() }}</span>
        <span class="time-separator">/</span>
        <span class="total-time">{{ formattedDuration() }}</span>
      </div>
    </div>

    <div class="header-right">
      <button
        class="sidebar-toggle"
        [class.active]="showSettingsSidebar()"
        (click)="toggleSettingsSidebar()"
        title="Toggle Settings"
      >
        ‚öôÔ∏è
      </button>
      <button
        class="sidebar-toggle"
        [class.active]="showInfoSidebar()"
        (click)="toggleInfoSidebar()"
        title="Toggle Info"
      >
        ‚ÑπÔ∏è
      </button>
    </div>
  </div>

  <!-- Main editor area -->
  <div class="editor-main">
    <!-- Settings Sidebar (Left) -->
    @if (showSettingsSidebar()) {
      <div class="settings-sidebar sidebar">
        <div class="sidebar-header">
          <h3 class="sidebar-title">
            <span class="sidebar-icon">‚öôÔ∏è</span>
            Settings
          </h3>
        </div>

        <div class="sidebar-content">
          <!-- Playback Settings -->
          <div class="settings-section">
            <h4 class="section-title">Playback</h4>

            <div class="setting-item">
              <label class="setting-label">Speed</label>
              <div class="speed-controls">
                @for (rate of [0.5, 0.75, 1, 1.25, 1.5, 2]; track rate) {
                  <button
                    class="speed-btn"
                    [class.active]="editorState().playbackRate === rate"
                    (click)="setPlaybackRate(rate)"
                  >
                    {{ rate }}x
                  </button>
                }
              </div>
            </div>

            <div class="setting-item">
              <label class="setting-label">
                Volume: {{ (editorState().volume * 100).toFixed(0) }}%
              </label>
              <input
                type="range"
                class="volume-slider"
                min="0"
                max="1"
                step="0.01"
                [value]="editorState().volume"
                (input)="setVolume(+$any($event.target).value)"
              />
            </div>
          </div>

          <!-- Timeline Settings -->
          <div class="settings-section">
            <h4 class="section-title">Timeline</h4>

            <div class="setting-item">
              <label class="setting-label">
                Zoom: {{ (editorState().zoom * 100).toFixed(0) }}%
              </label>
              <div class="zoom-controls">
                <button class="zoom-btn" (click)="zoomOut()">‚àí</button>
                <button class="zoom-btn" (click)="resetZoom()">Reset</button>
                <button class="zoom-btn" (click)="zoomIn()">+</button>
              </div>
            </div>

            <div class="setting-item">
              <label class="setting-checkbox">
                <input
                  type="checkbox"
                  [checked]="settings().snapToGrid"
                  (change)="updateSetting('snapToGrid', $any($event.target).checked)"
                />
                <span>Snap to Grid</span>
              </label>
            </div>

            <div class="setting-item">
              <label class="setting-checkbox">
                <input
                  type="checkbox"
                  [checked]="settings().showThumbnails"
                  (change)="updateSetting('showThumbnails', $any($event.target).checked)"
                />
                <span>Show Thumbnails</span>
              </label>
            </div>

            <div class="setting-item">
              <label class="setting-checkbox">
                <input
                  type="checkbox"
                  [checked]="settings().autoSave"
                  (change)="updateSetting('autoSave', $any($event.target).checked)"
                />
                <span>Auto Save</span>
              </label>
            </div>
          </div>

          <!-- Export Settings -->
          <div class="settings-section">
            <h4 class="section-title">Export</h4>

            <button class="export-btn">
              <span class="btn-icon">‚¨áÔ∏è</span>
              Export Video
            </button>
          </div>
        </div>
      </div>
    }

    <!-- Center Content Area -->
    <div class="editor-content">
      <!-- Video Player Area -->
      <div class="video-player-area">
        <div class="video-container">
          <div class="video-placeholder">
            <div class="placeholder-icon">üé•</div>
            <p class="placeholder-text">Video Player</p>
            <p class="placeholder-subtitle">{{ metadata().resolution }} ‚Ä¢ {{ metadata().frameRate }} fps</p>

            <!-- Playback progress bar -->
            <div class="video-progress">
              <div
                class="video-progress-bar"
                [style.width.%]="timelineProgress()"
              ></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Timeline Area -->
      <div class="timeline-area">
        <div class="timeline-header">
          <div class="timeline-title">Timeline</div>
          <div class="timeline-info">
            {{ clips().length }} clip{{ clips().length !== 1 ? 's' : '' }}
          </div>
        </div>

        <!-- Timeline ruler -->
        <div class="timeline-ruler">
          <div class="ruler-marks" [style.width.%]="editorState().zoom * 100">
            @for (mark of [0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 110, 120]; track mark) {
              @if (mark <= editorState().duration) {
                <div class="ruler-mark" [style.left.%]="(mark / editorState().duration) * 100">
                  <span class="ruler-time">{{ formatTime(mark) }}</span>
                </div>
              }
            }
          </div>
        </div>

        <!-- Timeline tracks -->
        <div class="timeline-tracks">
          <div class="timeline-scroll">
            <!-- Playhead -->
            <div
              class="playhead"
              [style.left.%]="timelineProgress()"
            >
              <div class="playhead-handle"></div>
              <div class="playhead-line"></div>
            </div>

            <!-- Markers -->
            @for (marker of markers(); track marker.id) {
              <div
                class="timeline-marker"
                [style.left.%]="(marker.time / editorState().duration) * 100"
                [style.--marker-color]="marker.color"
              >
                <div class="marker-flag">{{ marker.label }}</div>
                <div class="marker-line"></div>
              </div>
            }

            <!-- Video clips -->
            @for (clip of clips(); track clip.id) {
              <div
                class="timeline-clip"
                [class.selected]="editorState().selectedClip?.id === clip.id"
                [style.left.%]="(clip.startTime / editorState().duration) * 100"
                [style.width.%]="((clip.endTime - clip.startTime) / editorState().duration) * 100"
                [style.top.px]="clip.track * 140"
                (click)="selectClip(clip)"
              >
                <div class="clip-header">
                  <span class="clip-name">{{ clip.name }}</span>
                  <button class="clip-delete" (click)="deleteClip(clip.id); $event.stopPropagation()">√ó</button>
                </div>

                <!-- Waveform -->
                @if (clip.waveformData) {
                  <div class="clip-waveform">
                    <svg class="waveform-svg" viewBox="0 0 100 40" preserveAspectRatio="none">
                      <path
                        class="waveform-path"
                        [attr.d]="generateWaveformPath(clip.waveformData.samples)"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="1"
                      />
                    </svg>
                  </div>
                }
              </div>
            }
          </div>
        </div>

        <!-- Timeline scrollbar with zoom/pan handles -->
        <div class="timeline-scrollbar">
          <div class="scrollbar-track">
            <div
              class="scrollbar-thumb"
              [style.left.%]="scrollPosition"
              [style.width.%]="Math.min(100, 100 / editorState().zoom)"
            >
              <div class="scrollbar-handle left" title="Drag to zoom"></div>
              <div class="scrollbar-center" title="Drag to pan"></div>
              <div class="scrollbar-handle right" title="Drag to zoom"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Info Sidebar (Right) -->
    @if (showInfoSidebar()) {
      <div class="info-sidebar sidebar">
        <div class="sidebar-header">
          <h3 class="sidebar-title">
            <span class="sidebar-icon">‚ÑπÔ∏è</span>
            Information
          </h3>
        </div>

        <div class="sidebar-content">
          <!-- File Info -->
          <div class="info-section">
            <h4 class="section-title">File Information</h4>

            <div class="info-grid">
              <div class="info-item">
                <span class="info-label">Filename</span>
                <span class="info-value">{{ metadata().filename }}</span>
              </div>

              <div class="info-item">
                <span class="info-label">Format</span>
                <span class="info-value">{{ metadata().format }}</span>
              </div>

              <div class="info-item">
                <span class="info-label">Resolution</span>
                <span class="info-value">{{ metadata().resolution }}</span>
              </div>

              <div class="info-item">
                <span class="info-label">Frame Rate</span>
                <span class="info-value">{{ metadata().frameRate }} fps</span>
              </div>

              <div class="info-item">
                <span class="info-label">Codec</span>
                <span class="info-value">{{ metadata().codec }}</span>
              </div>

              <div class="info-item">
                <span class="info-label">Bitrate</span>
                <span class="info-value">{{ metadata().bitrate }}</span>
              </div>

              <div class="info-item">
                <span class="info-label">Duration</span>
                <span class="info-value">{{ formatTime(metadata().duration) }}</span>
              </div>

              <div class="info-item">
                <span class="info-label">File Size</span>
                <span class="info-value">{{ formatFileSize(metadata().fileSize) }}</span>
              </div>
            </div>
          </div>

          <!-- Selected Clip Info -->
          @if (editorState().selectedClip) {
            <div class="info-section">
              <h4 class="section-title">Selected Clip</h4>

              <div class="info-grid">
                <div class="info-item">
                  <span class="info-label">Name</span>
                  <span class="info-value">{{ editorState().selectedClip?.name }}</span>
                </div>

                <div class="info-item">
                  <span class="info-label">Duration</span>
                  <span class="info-value">{{ formatTime(editorState().selectedClip?.duration || 0) }}</span>
                </div>

                <div class="info-item">
                  <span class="info-label">Start</span>
                  <span class="info-value">{{ formatTime(editorState().selectedClip?.startTime || 0) }}</span>
                </div>

                <div class="info-item">
                  <span class="info-label">End</span>
                  <span class="info-value">{{ formatTime(editorState().selectedClip?.endTime || 0) }}</span>
                </div>

                <div class="info-item">
                  <span class="info-label">Volume</span>
                  <span class="info-value">{{ ((editorState().selectedClip?.volume || 0) * 100).toFixed(0) }}%</span>
                </div>
              </div>
            </div>
          }

          <!-- Timeline Stats -->
          <div class="info-section">
            <h4 class="section-title">Timeline</h4>

            <div class="info-grid">
              <div class="info-item">
                <span class="info-label">Total Clips</span>
                <span class="info-value">{{ clips().length }}</span>
              </div>

              <div class="info-item">
                <span class="info-label">Markers</span>
                <span class="info-value">{{ markers().length }}</span>
              </div>

              <div class="info-item">
                <span class="info-label">Zoom Level</span>
                <span class="info-value">{{ (editorState().zoom * 100).toFixed(0) }}%</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    }
  </div>
</div>

<!-- Expose Math to template -->
@if (false) {
  {{ Math.min(0, 0) }}
}
