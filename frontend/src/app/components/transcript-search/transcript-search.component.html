<div class="transcript-search-container">
  <div class="search-input-wrapper">
    <mat-form-field appearance="outline" class="search-field" [class.disabled]="!transcriptExists">
      <input
        matInput
        [(ngModel)]="searchQuery"
        (ngModelChange)="onSearchInput()"
        [disabled]="!transcriptExists"
        placeholder="Search transcript"
        autocomplete="off">
      <button
        mat-icon-button
        matSuffix
        *ngIf="searchQuery"
        (click)="clearSearch()"
        [disabled]="!transcriptExists">
        <mat-icon>close</mat-icon>
      </button>
      <mat-icon matPrefix>search</mat-icon>
    </mat-form-field>
  </div>

  <!-- Search Options -->
  <div class="search-options" *ngIf="transcriptExists">
    <button
      mat-button
      class="search-option-btn"
      [class.active]="useWildcards"
      (click)="useWildcards = !useWildcards; useBooleanLogic = false; onSearchInput()"
      matTooltip="Enable wildcards (* and ?) in search">
      <mat-icon>{{useWildcards ? 'check_box' : 'check_box_outline_blank'}}</mat-icon>
      <span>Wildcards</span>
    </button>
    <button
      mat-button
      class="search-option-btn"
      [class.active]="useBooleanLogic"
      (click)="useBooleanLogic = !useBooleanLogic; useWildcards = false; onSearchInput()"
      matTooltip="Enable boolean operators (AND, OR, NOT)">
      <mat-icon>{{useBooleanLogic ? 'check_box' : 'check_box_outline_blank'}}</mat-icon>
      <span>Boolean</span>
    </button>
    <button
      mat-button
      class="search-option-btn save-search-btn"
      [disabled]="!searchQuery"
      (click)="saveCurrentSearch()"
      matTooltip="Save current search query">
      <mat-icon>bookmark_add</mat-icon>
      <span>Save</span>
    </button>
  </div>

  <!-- Saved Searches Accordion -->
  <mat-accordion *ngIf="transcriptExists && savedSearches.length > 0" class="saved-searches-accordion">
    <mat-expansion-panel [(expanded)]="savedSearchesExpanded" class="saved-searches-panel">
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon>bookmarks</mat-icon>
          <span>Saved Searches ({{ savedSearches.length }})</span>
        </mat-panel-title>
      </mat-expansion-panel-header>
      <div class="saved-searches-list">
        <div
          *ngFor="let search of savedSearches"
          class="saved-search-item"
          [matTooltip]="getSavedSearchTooltip(search)"
          matTooltipShowDelay="300"
          (click)="loadSavedSearch(search)">
          <div class="saved-search-content">
            <mat-icon class="saved-search-icon">
              {{ search.useWildcards ? 'asterisk' : (search.useBooleanLogic ? 'calculate' : 'search') }}
            </mat-icon>
            <span class="saved-search-query">{{ search.query }}</span>
          </div>
          <button
            mat-icon-button
            class="delete-search-btn"
            (click)="deleteSavedSearch(search, $event)"
            matTooltip="Delete saved search">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </div>
    </mat-expansion-panel>
  </mat-accordion>

  <!-- Run Transcription Button (shown when transcript doesn't exist) -->
  <div *ngIf="!transcriptExists" class="no-transcript-container">
    <mat-icon class="no-transcript-icon">transcribe</mat-icon>
    <h3>No Transcript</h3>
    <p>This video hasn't been transcribed yet. Generate a transcript to search through the spoken content.</p>
    <button
      mat-raised-button
      color="primary"
      class="run-transcription-btn"
      (click)="onRunAnalysis()">
      <mat-icon>play_arrow</mat-icon>
      Generate Transcript
    </button>
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="isSearching" class="search-loading">
    <mat-spinner diameter="20"></mat-spinner>
    <p>Searching...</p>
  </div>

  <!-- Search Results as Section Items -->
  <div *ngIf="!isSearching && matches.length > 0" class="search-results-container">
    <p class="results-hint">{{ matches.length }} result{{ matches.length !== 1 ? 's' : '' }} found - Click to jump to timestamp</p>
    <div class="search-results-list">
      <div
        *ngFor="let match of matches"
        class="search-result-item"
        [class.selected]="selectedMatchIndex === match.index"
        (click)="onMatchClick(match)">
        <div class="result-marker"></div>
        <div class="result-content">
          <div class="result-header">
            <span class="result-time" *ngIf="match.timestamp !== undefined">
              {{ formatTime(match.timestamp) }}
            </span>
            <span class="result-match-label">Match</span>
          </div>
          <p class="result-text">{{ match.context }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- No Results Message -->
  <div *ngIf="!isSearching && matches.length === 0 && searchQuery" class="no-results">
    <mat-icon>search_off</mat-icon>
    <p>No matches found for "{{ searchQuery }}"</p>
  </div>
</div>
