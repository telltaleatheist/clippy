<div class="transcript-search-container">
  <div class="search-input-wrapper">
    <mat-form-field appearance="outline" class="search-field" [class.disabled]="!transcriptExists">
      <input
        matInput
        [(ngModel)]="searchQuery"
        (ngModelChange)="onSearchInput()"
        [disabled]="!transcriptExists"
        placeholder="Search transcript"
        autocomplete="off">
      <button
        mat-icon-button
        matSuffix
        *ngIf="searchQuery"
        (click)="clearSearch()"
        [disabled]="!transcriptExists">
        <mat-icon>close</mat-icon>
      </button>
      <mat-icon matPrefix>search</mat-icon>
    </mat-form-field>

    <!-- Run Analysis Button (shown when transcript doesn't exist) -->
    <button
      *ngIf="!transcriptExists"
      mat-raised-button
      color="primary"
      class="run-analysis-btn"
      (click)="onRunAnalysis()">
      <mat-icon>transcribe</mat-icon>
      Run Transcription
    </button>
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="isSearching" class="search-loading">
    <mat-spinner diameter="20"></mat-spinner>
    <p>Searching...</p>
  </div>

  <!-- Search Results as Section Items -->
  <div *ngIf="!isSearching && matches.length > 0" class="search-results-container">
    <p class="results-hint">{{ matches.length }} result{{ matches.length !== 1 ? 's' : '' }} found - Click to jump to timestamp</p>
    <div class="search-results-list">
      <div
        *ngFor="let match of matches"
        class="search-result-item"
        [class.selected]="selectedMatchIndex === match.index"
        (click)="onMatchClick(match)">
        <div class="result-marker"></div>
        <div class="result-content">
          <div class="result-header">
            <span class="result-time" *ngIf="match.timestamp !== undefined">
              {{ formatTime(match.timestamp) }}
            </span>
            <span class="result-match-label">Match</span>
          </div>
          <p class="result-text">{{ match.context }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- No Results Message -->
  <div *ngIf="!isSearching && matches.length === 0 && searchQuery" class="no-results">
    <mat-icon>search_off</mat-icon>
    <p>No matches found for "{{ searchQuery }}"</p>
  </div>
</div>
