<!-- Batch Download - Creamsicle Theme -->
<div class="batch-container">
  <div class="page-content">
    <!-- Job Queue -->
    <div class="panel full-height-panel">
      <div class="panel-header">
        <h4 class="panel-title">ðŸ“¥ Download Queue</h4>
        <div class="panel-header-actions">
          <button mat-raised-button (click)="openDownloadOptionsDialog()">
            <mat-icon>settings</mat-icon> Download Options
          </button>
          <button mat-raised-button color="primary" (click)="openPasteUrlsDialog()">
            <mat-icon>add</mat-icon> Paste URLs
          </button>
        </div>
      </div>

      <div class="panel-content">
        <!-- Active Jobs List -->
        <div class="jobs-list">
          <div *ngFor="let job of getActiveJobsForDisplay()"
               class="job-card"
               [ngClass]="'job-' + (job.status || 'unknown')">

            <div class="job-content" (click)="toggleJobDetails(job.id)">
              <span class="job-title">{{ getDisplayName(job) }}</span>
              <div class="job-right">
                <span class="badge" [ngClass]="'badge-' + getStatusBadgeType(job.status || '')">
                  {{ isProcessingJob(job) ? 'Processing' : job.status }}
                </span>
                <button type="button"
                        *ngIf="job.status === 'downloaded' || job.status === 'processing' || job.status === 'transcribing'"
                        class="skip-button"
                        (click)="skipJob(job.id); $event.stopPropagation()"
                        title="Skip processing - keep original download"
                        matTooltip="Skip re-encoding and processing. Keep the original downloaded file.">
                  <mat-icon>skip_next</mat-icon>
                </button>
                <button type="button"
                        class="remove-button"
                        (click)="removeJob(job); $event.stopPropagation()"
                        title="Remove from queue">
                  <mat-icon>close</mat-icon>
                </button>
              </div>
            </div>

            <!-- Expandable URL section -->
            <div class="job-details" *ngIf="isJobDetailsExpanded(job.id)">
              <div class="url-container">
                <span class="url-label">URL:</span>
                <input class="url-input" [value]="job.url" readonly (click)="($any($event.target)).select()">
                <button mat-icon-button
                        class="copy-button"
                        (click)="copyUrl(job.url)"
                        title="Copy URL">
                  <mat-icon>content_copy</mat-icon>
                </button>
              </div>
            </div>

            <div class="progress-bar" [style.width.%]="job.progress || 0"></div>
          </div>

          <div class="empty-state" *ngIf="getActiveJobsForDisplay().length === 0">
            <mat-icon class="empty-icon">inbox</mat-icon>
            <p>No active jobs</p>
            <p class="empty-hint">Click "Paste URLs" to add videos to the queue</p>
          </div>
        </div>

        <!-- Completed Jobs Accordion -->
        <mat-accordion *ngIf="hasCompletedJobs()" class="completed-accordion">
          <mat-expansion-panel>
            <mat-expansion-panel-header>
              <mat-panel-title>
                <mat-icon>history</mat-icon>
                Completed & Failed ({{ getCompletedJobsForDisplay().length }})
              </mat-panel-title>
            </mat-expansion-panel-header>

            <div class="completed-jobs-list">
              <div *ngFor="let job of getCompletedJobsForDisplay()"
                   class="job-card job-completed"
                   [ngClass]="'job-' + (job.status || 'unknown')">

                <div class="job-content" (click)="toggleJobDetails(job.id)">
                  <span class="job-title">{{ getDisplayName(job) }}</span>
                  <div class="job-right">
                    <span class="badge" [ngClass]="'badge-' + getStatusBadgeType(job.status || '')">
                      {{ job.status }}
                    </span>
                    <button type="button"
                            class="remove-button"
                            (click)="removeJob(job); $event.stopPropagation()"
                            title="Remove from list">
                      <mat-icon>close</mat-icon>
                    </button>
                  </div>
                </div>

                <!-- Expandable URL section -->
                <div class="job-details" *ngIf="isJobDetailsExpanded(job.id)">
                  <div class="url-container">
                    <span class="url-label">URL:</span>
                    <input class="url-input" [value]="job.url" readonly (click)="($any($event.target)).select()">
                    <button mat-icon-button
                            class="copy-button"
                            (click)="copyUrl(job.url)"
                            title="Copy URL">
                      <mat-icon>content_copy</mat-icon>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </mat-expansion-panel>
        </mat-accordion>

        <div class="panel-actions">
          <button mat-raised-button color="primary" (click)="startQueue()" [disabled]="!hasPendingJobs()">
            <mat-icon>play_arrow</mat-icon> Start Queue
          </button>

          <button mat-stroked-button color="warn" (click)="clearQueue()"
                [disabled]="!hasActiveJobs()">
            <mat-icon>clear_all</mat-icon> Clear Queue
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
