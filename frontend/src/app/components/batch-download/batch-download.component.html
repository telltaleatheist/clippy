<div class="batch-container">
  <!-- Header with stats and actions -->
  <div class="batch-header">
    <div class="header-content">
      <h1>
        <mat-icon>cloud_download</mat-icon>
        Batch Downloads
      </h1>

      <!-- Library Selector -->
      <div class="library-selector" *ngIf="!isLoadingLibraries && libraries.length > 0">
        <mat-form-field appearance="outline" class="library-dropdown">
          <mat-label>Target Library</mat-label>
          <mat-select [(ngModel)]="selectedLibraryId" (selectionChange)="onLibraryChange()">
            <mat-option *ngFor="let library of libraries" [value]="library.id">
              <mat-icon>folder</mat-icon>
              {{ library.name }}
            </mat-option>
          </mat-select>
          <mat-icon matPrefix>library_books</mat-icon>
          <mat-hint>Videos will be imported to this library</mat-hint>
        </mat-form-field>
      </div>

      <!-- Stats chips -->
      <div class="stats-chips" *ngIf="batchQueueStatus">
        <mat-chip-set>
          <mat-chip *ngIf="getActiveJobsForDisplay().length > 0" class="badge status-active">
            <mat-icon>downloading</mat-icon>
            {{ getActiveJobsForDisplay().length }} Active
          </mat-chip>
          <mat-chip *ngIf="batchQueueStatus.completedJobs && batchQueueStatus.completedJobs.length > 0" class="tag success">
            <mat-icon>check_circle</mat-icon>
            {{ batchQueueStatus.completedJobs.length }} Completed
          </mat-chip>
          <mat-chip *ngIf="batchQueueStatus.failedJobs && batchQueueStatus.failedJobs.length > 0" class="tag warning">
            <mat-icon>error</mat-icon>
            {{ batchQueueStatus.failedJobs.length }} Failed
          </mat-chip>
        </mat-chip-set>
      </div>
    </div>

    <!-- Action buttons -->
    <div class="header-actions">
      <button mat-raised-button color="primary" (click)="openPasteUrlsDialog()">
        <mat-icon>add</mat-icon>
        Paste URLs
      </button>
      <button mat-raised-button
              color="primary"
              (click)="startQueue()"
              [disabled]="!canStartQueue()">
        <mat-icon>play_arrow</mat-icon>
        <span>Start Queue</span>
      </button>
      <button mat-stroked-button color="warn" (click)="clearQueue()" [disabled]="!hasActiveJobs()">
        <mat-icon>clear_all</mat-icon>
        Clear All
      </button>
      <button mat-icon-button (click)="openDownloadOptionsDialog()" matTooltip="Download Options">
        <mat-icon>settings</mat-icon>
      </button>
    </div>
  </div>

  <!-- Jobs List with Cascade -->
  <div class="jobs-viewport">
    <!-- Active Jobs Section -->
    <div class="jobs-section active-jobs" *ngIf="activeJobsAsListItems.length > 0">
      <div class="section-header">
        <h3>
          <mat-icon>downloading</mat-icon>
          Active Downloads
        </h3>
      </div>
      <cascade-list
        [items]="activeJobsAsListItems"
        [displayConfig]="jobDisplayConfig"
        [childrenConfig]="childrenConfig"
        [selectionMode]="SelectionMode.None"
        [progressMapper]="jobProgressMapper"
        [enableDragDrop]="false"
        emptyMessage="No active jobs"
        emptyIcon="cloud_download">

        <!-- Custom action template for X button -->
        <ng-template #itemActions let-item>
          <button mat-icon-button
                  (click)="removeJob(item); $event.stopPropagation()"
                  matTooltip="Remove from queue"
                  class="remove-job-btn">
            <mat-icon>close</mat-icon>
          </button>
        </ng-template>
      </cascade-list>
    </div>

    <!-- Completed Jobs Section -->
    <div class="jobs-section completed-jobs" *ngIf="hasCompletedJobs()">
      <div class="section-header">
        <h3>
          <mat-icon>history</mat-icon>
          Completed Downloads
        </h3>
        <button mat-stroked-button
                color="warn"
                (click)="clearCompletedJobs()"
                class="clear-completed-btn">
          <mat-icon>delete_sweep</mat-icon>
          Clear Completed
        </button>
      </div>
      <cascade-list
        [items]="completedJobsAsListItems"
        [displayConfig]="jobDisplayConfig"
        [childrenConfig]="childrenConfig"
        [selectionMode]="SelectionMode.None"
        [progressMapper]="jobProgressMapper"
        [enableDragDrop]="false"
        emptyMessage="No completed jobs"
        emptyIcon="check_circle">

        <!-- Custom action template for X button -->
        <ng-template #itemActions let-item>
          <button mat-icon-button
                  (click)="removeJob(item); $event.stopPropagation()"
                  matTooltip="Remove from list"
                  class="remove-job-btn">
            <mat-icon>close</mat-icon>
          </button>
        </ng-template>
      </cascade-list>
    </div>

    <!-- Empty state -->
    <div class="empty-state" *ngIf="activeJobsAsListItems.length === 0 && !hasCompletedJobs()">
      <mat-icon>cloud_download</mat-icon>
      <h2>No downloads in queue</h2>
      <p>Click "Paste URLs" to add videos to download</p>
    </div>
  </div>
</div>
