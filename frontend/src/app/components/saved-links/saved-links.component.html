<div class="saved-links-container"
     (dragover)="onDragOver($event)"
     (dragleave)="onDragLeave($event)"
     (drop)="onDrop($event)"
     [class.dragging]="isDragging">
  <!-- Drag Overlay -->
  <div class="drag-overlay" *ngIf="isDragging">
    <div class="drag-content">
      <mat-icon>link</mat-icon>
      <h3>Drop URL here to download</h3>
      <p>The video will be automatically downloaded and added to your library</p>
    </div>
  </div>

  <div class="header">
    <h2>Saved for Later</h2>
    <div class="stats">
      <mat-chip-set>
        <mat-chip class="stat-chip" [highlighted]="!filterStatus" (click)="filterByStatus(undefined)">
          All ({{ savedLinks.length }})
        </mat-chip>
        <mat-chip class="stat-chip" [highlighted]="filterStatus === 'pending'" (click)="filterByStatus('pending')">
          Pending ({{ pendingCount }})
        </mat-chip>
        <mat-chip class="stat-chip" [highlighted]="filterStatus === 'downloading'" (click)="filterByStatus('downloading')">
          Downloading ({{ downloadingCount }})
        </mat-chip>
        <mat-chip class="stat-chip" [highlighted]="filterStatus === 'completed'" (click)="filterByStatus('completed')">
          Completed ({{ completedCount }})
        </mat-chip>
        <mat-chip class="stat-chip" [highlighted]="filterStatus === 'failed'" (click)="filterByStatus('failed')">
          Failed ({{ failedCount }})
        </mat-chip>
      </mat-chip-set>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Loading saved links...</p>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && savedLinks.length === 0" class="empty-state">
    <mat-icon class="empty-icon">link_off</mat-icon>
    <h3>No saved links</h3>
    <p>Use the web interface on your phone to save links while you're out!</p>
    <p class="hint">Visit: <strong>http://owens-mac-studio.local:3000/saved</strong></p>
  </div>

  <!-- Links List -->
  <div *ngIf="!isLoading && savedLinks.length > 0" class="links-list">
    <div *ngFor="let link of savedLinks" class="link-row" [class]="'status-' + link.status">
      <!-- Status Icon -->
      <div class="card-icon">
        <mat-icon [matTooltip]="link.status">
          {{ getStatusIcon(link.status) }}
        </mat-icon>
      </div>

      <!-- Content (clickable) - single line -->
      <div class="card-content" (click)="openUrl(link, $event)">
        <span class="link-title">{{ link.title || 'Untitled' }}</span>
        <span class="link-subtitle">
          <span>{{ formatDate(link.date_added) }}</span>
          <span *ngIf="link.url"> • {{ truncateUrl(link.url) }}</span>
          <span *ngIf="link.error_message" class="error-text"> • {{ link.error_message }}</span>
          <span *ngIf="link.status === 'completed' && link.download_path" class="success-text"> • Downloaded successfully</span>
        </span>
      </div>

      <!-- Action buttons -->
      <div class="card-actions">
        <button mat-icon-button (click)="openUrl(link, $event)" matTooltip="Open URL in browser">
          <mat-icon>open_in_new</mat-icon>
        </button>

        <button
          *ngIf="link.status === 'failed'"
          mat-icon-button
          color="primary"
          (click)="retryLink(link, $event)"
          matTooltip="Retry download">
          <mat-icon>refresh</mat-icon>
        </button>

        <button
          mat-icon-button
          color="warn"
          (click)="deleteLink(link, $event)"
          matTooltip="Delete this saved link">
          <mat-icon>delete</mat-icon>
        </button>
      </div>
    </div>
  </div>
</div>
