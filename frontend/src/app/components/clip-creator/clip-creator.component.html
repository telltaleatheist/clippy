<div class="clip-creator-container">
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">
        <mat-icon>content_cut</mat-icon>
        Clip Creator
      </h1>
      <p class="page-subtitle">Select a video to edit and create clips</p>
    </div>
  </div>

  <div class="page-content">
    <!-- Tabs for Active and Archived -->
    <mat-tab-group [(selectedIndex)]="selectedTabIndex" animationDuration="200ms">

      <!-- Active Tab -->
      <mat-tab label="Active">
        <!-- Custom Video Upload Section -->
        <div class="upload-section">
          <button
            mat-raised-button
            color="primary"
            class="upload-button"
            (click)="selectCustomVideo()">
            <mat-icon>upload_file</mat-icon>
            Select Custom Video File
          </button>
          <p class="upload-hint">Choose any video file from your computer to edit</p>
        </div>

        <!-- Divider -->
        <div class="divider">
          <span>OR SELECT FROM LIBRARY</span>
        </div>

        <!-- Loading State -->
        <div *ngIf="isLoading" class="loading-container">
          <mat-spinner diameter="60"></mat-spinner>
          <p>Loading video library...</p>
        </div>

        <!-- Empty State -->
        <div *ngIf="!isLoading && activeAnalyses.length === 0" class="empty-state">
          <mat-icon>video_library</mat-icon>
          <h3>No Videos Available</h3>
          <p>Run video analysis to add videos to your library, or upload a custom video file above.</p>
        </div>

        <!-- Video Library Grid -->
        <div *ngIf="!isLoading && activeAnalyses.length > 0" class="video-grid">
          <mat-card
            *ngFor="let analysis of activeAnalyses"
            class="video-card"
            (click)="selectVideo(analysis)">
            <mat-card-header>
              <!-- Menu button in header -->
              <button mat-icon-button [matMenuTriggerFor]="menu" (click)="$event.stopPropagation()" matTooltip="More options" class="header-menu-button">
                <mat-icon>more_vert</mat-icon>
              </button>
              <mat-menu #menu="matMenu">
                <button mat-menu-item (click)="startRename(analysis, $event)">
                  <mat-icon>edit</mat-icon>
                  <span>Rename</span>
                </button>
                <button mat-menu-item (click)="relinkVideo(analysis); $event.stopPropagation()">
                  <mat-icon>link</mat-icon>
                  <span>Relink</span>
                </button>
                <button mat-menu-item (click)="archiveAnalysis(analysis, $event)">
                  <mat-icon>archive</mat-icon>
                  <span>Archive</span>
                </button>
                <button mat-menu-item (click)="deleteAnalysis(analysis, $event)" class="delete-option">
                  <mat-icon>delete</mat-icon>
                  <span>Delete</span>
                </button>
              </mat-menu>

              <div class="card-icon">
                <mat-icon>movie</mat-icon>
              </div>

              <!-- Editable Title -->
              <div *ngIf="!isEditing(analysis)" class="card-title-container">
                <mat-card-title>{{ analysis.title }}</mat-card-title>
                <mat-card-subtitle>{{ formatDate(analysis.createdAt) }}</mat-card-subtitle>
              </div>

              <!-- Edit Title Input -->
              <div *ngIf="isEditing(analysis)" class="card-edit-container" (click)="$event.stopPropagation()">
                <mat-form-field appearance="outline" class="edit-field">
                  <input
                    matInput
                    [(ngModel)]="editingTitle"
                    (keyup.enter)="saveRename(analysis)"
                    (keyup.escape)="cancelRename()"
                    (blur)="saveRename(analysis)"
                    [autofocus]="true">
                </mat-form-field>
              </div>
            </mat-card-header>

            <mat-card-content>
              <div class="video-info">
                <div class="info-item" *ngIf="analysis.video.durationSeconds">
                  <mat-icon>schedule</mat-icon>
                  <span>{{ formatDuration(analysis.video.durationSeconds) }}</span>
                </div>
                <div class="info-item" *ngIf="analysis.metadata.categories.length > 0">
                  <mat-icon>label</mat-icon>
                  <span>{{ analysis.metadata.categories.length }} categories</span>
                </div>
              </div>
            </mat-card-content>

            <mat-card-actions>
              <button mat-raised-button color="primary" class="edit-button">
                <mat-icon>content_cut</mat-icon>
                EDIT VIDEO
              </button>
            </mat-card-actions>
          </mat-card>
        </div>
      </mat-tab>

      <!-- Archived Tab -->
      <mat-tab label="Archived">
        <!-- Loading State -->
        <div *ngIf="isLoading" class="loading-container">
          <mat-spinner diameter="60"></mat-spinner>
          <p>Loading archived videos...</p>
        </div>

        <!-- Empty State -->
        <div *ngIf="!isLoading && archivedAnalyses.length === 0" class="empty-state">
          <mat-icon>archive</mat-icon>
          <h3>No Archived Videos</h3>
          <p>Videos you archive will appear here.</p>
        </div>

        <!-- Archived Videos List -->
        <mat-list *ngIf="!isLoading && archivedAnalyses.length > 0" class="archived-list">
          <mat-list-item
            *ngFor="let analysis of archivedAnalyses"
            class="archived-item"
            (click)="selectVideo(analysis)">

            <mat-icon matListItemIcon>movie</mat-icon>

            <!-- Editable Title -->
            <div matListItemTitle *ngIf="!isEditing(analysis)" class="list-item-title">{{ analysis.title }}</div>

            <!-- Edit Title Input -->
            <div *ngIf="isEditing(analysis)" class="list-edit-container" (click)="$event.stopPropagation()">
              <mat-form-field appearance="outline" class="edit-field">
                <input
                  matInput
                  [(ngModel)]="editingTitle"
                  (keyup.enter)="saveRename(analysis)"
                  (keyup.escape)="cancelRename()"
                  (blur)="saveRename(analysis)">
              </mat-form-field>
            </div>

            <div matListItemMeta class="list-actions">
              <button mat-icon-button (click)="startRename(analysis, $event)" matTooltip="Rename">
                <mat-icon>edit</mat-icon>
              </button>
              <button mat-icon-button (click)="unarchiveAnalysis(analysis, $event)" matTooltip="Unarchive">
                <mat-icon>unarchive</mat-icon>
              </button>
              <button mat-icon-button (click)="deleteAnalysis(analysis, $event)" matTooltip="Delete" class="delete-button">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </mat-list-item>
        </mat-list>
      </mat-tab>

    </mat-tab-group>
  </div>
</div>
