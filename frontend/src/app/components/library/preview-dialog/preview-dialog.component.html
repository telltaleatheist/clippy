<div class="preview-dialog-container" cdkDrag cdkDragRootElement=".cdk-overlay-pane">
  <!-- Drag Handle Header -->
  <div class="preview-dialog-header" cdkDragHandle>
    <mat-icon class="drag-icon">drag_indicator</mat-icon>
    <span class="header-title">Preview</span>
    <button mat-icon-button
            (click)="toggleAutoPlay()"
            [color]="autoPlayEnabled ? 'primary' : ''"
            [matTooltip]="autoPlayEnabled ? 'Auto-play: On' : 'Auto-play: Off'"
            tabindex="-1">
      <mat-icon>{{ autoPlayEnabled ? 'play_circle' : 'pause_circle' }}</mat-icon>
    </button>
    <button mat-icon-button class="close-btn" (click)="dialogRef.close()" tabindex="-1">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <!-- Media Content -->
  <div class="preview-dialog-content">
    <!-- Video Player -->
    <video #videoPlayer
           *ngIf="data.video.media_type === 'video'"
           [src]="data.videoStreamUrl"
           controls
           class="media-player"
           tabindex="-1">
    </video>

    <!-- Audio Player -->
    <audio *ngIf="data.video.media_type === 'audio'"
           [src]="data.videoStreamUrl"
           controls
           class="media-player"
           tabindex="-1">
    </audio>

    <!-- Image Viewer -->
    <div *ngIf="data.video.media_type === 'image'" class="image-viewer">
      <img [src]="data.videoStreamUrl"
           [alt]="data.video.filename"
           (error)="onImageError()"
           (load)="onImageLoaded()"
           class="media-image">
    </div>

    <!-- Unsupported Media Type -->
    <div *ngIf="data.video.media_type !== 'video' && data.video.media_type !== 'audio' && data.video.media_type !== 'image'"
         class="unsupported-media">
      <mat-icon>{{ data.getMediaTypeIcon(data.video.media_type) }}</mat-icon>
      <p>{{ data.getMediaTypeLabel(data.video.media_type) }} preview not available</p>
      <p class="hint">Open "View Details" to see more information</p>
    </div>
  </div>

  <!-- Title -->
  <div class="preview-dialog-title">
    <span class="video-title">{{ data.parseFilename(data.video.filename).title }}</span>
  </div>

  <!-- Action Buttons -->
  <div class="preview-dialog-actions">
    <button mat-raised-button
            color="primary"
            (click)="analyze()"
            *ngIf="data.canAnalyzeMedia(data.video)"
            tabindex="-1">
      <mat-icon>psychology</mat-icon>
      Analyze
    </button>
    <button mat-raised-button
            color="accent"
            (click)="openVideoEditor()"
            *ngIf="data.canAnalyzeMedia(data.video)"
            tabindex="-1">
      <mat-icon>video_settings</mat-icon>
      Video Editor
    </button>
    <button mat-raised-button (click)="viewDetails()" tabindex="-1">
      <mat-icon>info</mat-icon>
      View Details
    </button>
  </div>

  <!-- Keyboard Hints -->
  <div class="preview-dialog-hints">
    <span><mat-icon>keyboard</mat-icon> Space</span>
    <span><mat-icon>keyboard</mat-icon> ↑↓</span>
    <span><mat-icon>keyboard</mat-icon> Esc</span>
  </div>
</div>
