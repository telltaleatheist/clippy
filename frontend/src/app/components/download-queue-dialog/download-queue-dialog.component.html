<div class="modal-overlay" (click)="close()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-content">
      <!-- Header Icon Section -->
      <div class="modal-icon">
        <span class="icon">{{ hasActiveJobs ? '‚ñ∂' : '‚Üì' }}</span>
      </div>

      <!-- Title -->
      <div class="modal-header">
        <h2 class="modal-title">Download & Processing Queue</h2>
      </div>

      <!-- Body Content -->
      <div class="modal-body">
        <!-- Overall Status Summary -->
        <div class="queue-summary" *ngIf="hasActiveJobs">
          <div class="summary-header">
            <div class="status-indicator" [class.active]="hasActiveJobs">
              <span class="status-icon">{{ batchProgress?.status === 'running' ? '‚ü≥' : '‚è∏' }}</span>
              <span>{{ statusText }}</span>
            </div>
            <div class="queue-stats">
              <span class="stat">{{ completedCount }} / {{ totalCount }} completed</span>
              <span class="stat" *ngIf="remainingInQueue > 0">{{ remainingInQueue }} in queue</span>
            </div>
          </div>

          <div class="progress-container">
            <div class="progress-bar">
              <div class="progress-fill" [style.width.%]="getProgressPercentage()"></div>
            </div>
            <span class="progress-text">{{ getProgressPercentage() }}%</span>
          </div>

          <div class="eta" *ngIf="batchProgress?.estimatedTimeRemaining">
            <span class="eta-icon">‚è±</span>
            <span>{{ formatTimeRemaining(batchProgress?.estimatedTimeRemaining) }}</span>
          </div>
        </div>

        <!-- Active Processing Jobs -->
        <div class="current-processing" *ngIf="getActiveJobs().length > 0">
          <div class="section-header">
            <span class="section-icon">‚ñ∂</span>
            <h3>Currently Processing</h3>
          </div>
          <div class="notification-item" *ngFor="let job of getActiveJobs()">
            <div class="notification-content">
              <div class="notification-header">
                <div class="notification-icon" [class.completed]="job.stage === 'completed'" [class.failed]="job.stage === 'failed'">
                  <span *ngIf="job.stage === 'completed'">‚úì</span>
                  <span *ngIf="job.stage === 'failed'">‚úï</span>
                  <span *ngIf="job.stage !== 'completed' && job.stage !== 'failed'">üé¨</span>
                </div>
                <div class="notification-text">
                  <div class="notification-title">{{ job.filename }}</div>
                  <div class="notification-status">
                    {{ getStatusText(job) }}
                    <span class="progress-percent" *ngIf="job.progress < 100">{{ job.progress }}%</span>
                  </div>
                </div>
              </div>
              <div class="progress-container" *ngIf="job.progress < 100">
                <div class="progress-bar small">
                  <div class="progress-fill" [style.width.%]="job.progress"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Queue List -->
        <div class="queue-section" *ngIf="remainingInQueue > 0">
          <div class="section-header">
            <span class="section-icon">‚è≥</span>
            <h3>Queued ({{ remainingInQueue }})</h3>
          </div>
          <div class="empty-queue-message">
            <span class="info-icon">‚Ñπ</span>
            <p>{{ remainingInQueue }} video{{ remainingInQueue !== 1 ? 's' : '' }} waiting to be processed</p>
          </div>
        </div>

        <!-- Completed & Failed Videos -->
        <div class="completed-section" *ngIf="getCompletedJobs().length > 0 || sortedVideos.length > 0">
          <div class="section-header">
            <span class="section-icon">üìú</span>
            <h3>Recently Processed</h3>
            <button class="clear-btn" (click)="clearCompleted(); $event.stopPropagation()">Clear All</button>
          </div>
          <div class="video-list">
            <!-- Show completed processing jobs -->
            <div class="notification-item completed-item" *ngFor="let job of getCompletedJobs()">
              <div class="notification-content">
                <div class="notification-header">
                  <div class="notification-icon" [class.completed]="job.stage === 'completed'" [class.failed]="job.stage === 'failed'">
                    <span *ngIf="job.stage === 'completed'">‚úì</span>
                    <span *ngIf="job.stage === 'failed'">‚úï</span>
                  </div>
                  <div class="notification-text">
                    <div class="notification-title">{{ getStatusText(job) }}</div>
                    <div class="notification-subtitle">{{ job.filename }}</div>
                    <div *ngIf="job.error" class="error-message">{{ job.error }}</div>
                  </div>
                  <div class="notification-time" *ngIf="job.completedAt">
                    {{ getRelativeTime(job.completedAt) }}
                  </div>
                </div>
              </div>
            </div>
            <!-- Show batch analysis completed videos -->
            <div class="notification-item completed-item" *ngFor="let video of sortedVideos">
              <div class="notification-content">
                <div class="notification-header">
                  <div class="notification-icon" [class.completed]="video.status === 'success'" [class.failed]="video.status === 'failed'">
                    <span *ngIf="video.status === 'success'">‚úì</span>
                    <span *ngIf="video.status === 'failed'">‚úï</span>
                  </div>
                  <div class="notification-text">
                    <div class="notification-title">{{ getStatusText(video) }}</div>
                    <div class="notification-subtitle">{{ video.filename }}</div>
                    <div *ngIf="video.error" class="error-message">{{ video.error }}</div>
                  </div>
                  <div class="notification-time">
                    {{ getRelativeTime(video.completedAt) }}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Empty State -->
        <div class="empty-state" *ngIf="getActiveJobs().length === 0 && getCompletedJobs().length === 0 && sortedVideos.length === 0">
          <span class="empty-icon">‚òÅ‚Üì</span>
          <h3>No Active Downloads</h3>
          <p>Videos you download or analyze will appear here</p>
        </div>
      </div>

      <!-- Footer Actions -->
      <div class="modal-footer">
        <button class="btn-action" (click)="pauseBatch(); $event.stopPropagation()" *ngIf="batchProgress?.status === 'running'">
          ‚è∏ Pause
        </button>
        <button class="btn-action" (click)="resumeBatch(); $event.stopPropagation()" *ngIf="batchProgress?.status === 'paused'">
          ‚ñ∂ Resume
        </button>
        <button class="btn-action warn" (click)="stopBatch(); $event.stopPropagation()" *ngIf="hasActiveJobs">
          ‚èπ Stop All
        </button>
        <button class="btn-okay" (click)="close()">Close</button>
      </div>
    </div>
  </div>
</div>
