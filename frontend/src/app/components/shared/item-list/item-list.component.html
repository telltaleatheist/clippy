<div class="item-list-container" #listContainer tabindex="0">
  <!-- Empty State -->
  <div *ngIf="isEmpty" class="empty-state">
    <mat-icon class="empty-icon">{{ emptyIcon }}</mat-icon>
    <p class="empty-message">{{ emptyMessage }}</p>
  </div>

  <!-- Item Groups -->
  <div *ngIf="!isEmpty" class="item-groups">
    <div *ngFor="let group of groupedItems; trackBy: trackByGroupId" class="item-group">
      <!-- Group Header (only show if grouping is enabled) -->
      <div *ngIf="groupConfig?.enabled"
           class="group-header"
           (click)="toggleGroup(group.id)">
        <mat-icon class="collapse-icon">
          {{ isGroupCollapsed(group.id) ? 'chevron_right' : 'expand_more' }}
        </mat-icon>
        <span class="group-label">{{ group.label }}</span>
        <span class="group-count">({{ group.items.length }})</span>
      </div>

      <!-- Items List -->
      <div *ngIf="!isGroupCollapsed(group.id)" class="items-list">
        <div
          *ngFor="let item of group.items; let i = index; trackBy: trackByItemId"
          [id]="'item-' + item.id"
          class="item-card"
          [class.selected]="isItemSelected(item)"
          [class.highlighted]="isItemHighlighted(item)"
          [class.selection-edge-top]="isSelectionEdgeTop(group.items, i)"
          [class.selection-edge-bottom]="isSelectionEdgeBottom(group.items, i)"
          [class.is-child]="item['isChild']"
          [class.is-parent]="item['isParent']"
          [class.is-ghost-parent]="item['isGhostParent']"
          [class.is-ghost-child]="item['isGhostChild']"
          (click)="handleItemClick(item, $event)"
          (dblclick)="handleItemDoubleClick(item)"
          (contextmenu)="handleContextMenu($event, item)">

          <!-- Status Indicator -->
          <div *ngIf="getStatus(item)"
               class="status-indicator"
               [style.background-color]="getStatus(item)!.color"
               [matTooltip]="getStatus(item)!.tooltip || ''">
          </div>

          <!-- Icon -->
          <mat-icon class="item-icon">{{ getIcon(item) }}</mat-icon>

          <!-- Content -->
          <div class="item-content">
            <!-- Badge -->
            <span *ngIf="getBadge(item)" class="item-badge">
              {{ getBadge(item) }}
            </span>

            <!-- Primary Text -->
            <div class="item-primary">{{ getPrimaryText(item) }}</div>

            <!-- Secondary Text -->
            <div *ngIf="getSecondaryText(item)" class="item-secondary">
              {{ getSecondaryText(item) }}
            </div>
          </div>

          <!-- Metadata (duration, size, etc.) - displayed on the right -->
          <div *ngIf="getMetadata(item)" class="item-metadata">
            {{ getMetadata(item) }}
          </div>

          <!-- Custom Action Slot (for buttons like delete, remove, etc.) -->
          <div class="item-actions" *ngIf="hasItemActions">
            <ng-container *ngTemplateOutlet="itemActionsTemplate; context: { $implicit: item }"></ng-container>
          </div>

          <!-- Progress Bar -->
          <div *ngIf="getProgress(item)"
               class="item-progress-bar"
               [attr.aria-label]="getProgress(item)!.label || 'Progress: ' + getProgress(item)!.value + '%'"
               role="progressbar"
               [attr.aria-valuenow]="getProgress(item)!.value"
               aria-valuemin="0"
               aria-valuemax="100">
            <div class="progress-fill"
                 [style.width.%]="getProgress(item)!.value"
                 [style.background-color]="getProgress(item)!.color || null">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
